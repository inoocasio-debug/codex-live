<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Code X Live 2.3 - Ultra Visual</title>
<style>
body { font-family: Arial; margin: 10px; background:#111; color:#fff; }
h1 { color:#0ff; font-size:1.5em; margin-bottom:5px; }
input { padding:5px; width:100px; margin-bottom:5px; }
#dashboard { display:flex; flex-direction:column; gap:10px; }
#orderbook { background:#222; padding:10px; border-radius:5px; }
#orderbook canvas { width:100%; height:150px; }
#signal { background:#222; padding:10px; border-radius:5px; }
.momentum { height:20px; background:#444; border-radius:5px; overflow:hidden; margin-top:5px; }
.momentum-bar { height:100%; width:0%; transition: width 0.3s, background 0.3s; }
.signal-buy { color:#0f0; font-weight:bold; font-size:1.2em; }
.signal-sell { color:#f00; font-weight:bold; font-size:1.2em; }
.signal-hold { color:#ff0; font-weight:bold; font-size:1.2em; }
</style>
</head>
<body>
<h1>Code X Live 2.3 - Ultra Visual</h1>
<label>Market ID: </label>
<input id="marketId" value="market123">

<div id="dashboard">
  <div id="orderbook">
    <h2>Orderbook</h2>
    <canvas id="orderbookCanvas"></canvas>
    <div class="momentum">
      <div class="momentum-bar" id="momentumBar"></div>
    </div>
  </div>
  <div id="signal">
    <h2>Se√±al</h2>
    <pre id="signalOutput">Cargando...</pre>
  </div>
</div>

<script>
const baseUrl = "https://codex-live-1.onrender.com";
const canvas = document.getElementById('orderbookCanvas');
const ctx = canvas.getContext('2d');

function drawOrderbook(bids, asks) {
    ctx.clearRect(0,0,canvas.width,canvas.height);
    const w = canvas.width / Math.max(bids.length, asks.length);
    // Dibujar bids
    bids.forEach((b,i) => {
        ctx.fillStyle = "#0f0";
        const h = (b.size/5)*canvas.height;
        ctx.fillRect(i*w, canvas.height - h, w*0.8, h);
    });
    // Dibujar asks
    asks.forEach((a,i) => {
        ctx.fillStyle = "#f00";
        const h = (a.size/5)*canvas.height;
        ctx.fillRect(i*w, canvas.height - h, w*0.8, h);
    });
}

async function fetchData() {
    const market = document.getElementById('marketId').value;

    // Orderbook
    const resOB = await fetch(`${baseUrl}/orderbook/${market}`);
    const dataOB = await resOB.json();
    drawOrderbook(dataOB.orderbook.bids, dataOB.orderbook.asks);

    // Momentum
    const bar = document.getElementById('momentumBar');
    bar.style.width = dataOB.momentum + "%";
    bar.style.backgroundColor = dataOB.momentum > 65 ? "#0f0" : dataOB.momentum < 35 ? "#f00" : "#ff0";

    // Signal
    const payload = { market: market, size: 10 };
    const resSig = await fetch(`${baseUrl}/signal`, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(payload)
    });
    const dataSig = await resSig.json();
    let actionColor = dataSig.recommended_action === "BUY" ? "signal-buy" :
                      dataSig.recommended_action === "SELL" ? "signal-sell" : "signal-hold";
    document.getElementById('signalOutput').innerHTML =
        `<span class="${actionColor}">${dataSig.recommended_action}</span>\nMomentum: ${dataSig.momentum}\nSize: ${dataSig.size}`;
}

// Actualizar cada 1 segundo
setInterval(fetchData, 1000);
fetchData();
</script>
</body>
</html>
