<!DOCTYPE html>
<html>
<head>
  <title>CODE X LIVE</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body { font-family:sans-serif; background:#1e1e1e; color:white; margin:0; padding:0;}
    h1 { text-align:center; margin-top:20px;}
    #event { text-align:center; font-size:1.2em; margin-top:20px; }
    #signal { font-size:2em; text-align:center; margin-top:40px; padding:20px; border-radius:10px; }
    #size { font-size:1.2em; text-align:center; margin-top:10px; }
    #capital { text-align:center; margin-top:20px; font-size:1em; }
    #mockup { display:block; margin:auto; margin-top:20px; max-width:80%; border-radius:10px; }
  </style>
</head>
<body>
  <h1>CODE X LIVE</h1>
  <div id="event">Cargando evento...</div>
  <div id="signal">Cargando...</div>
  <div id="size"></div>
  <div id="capital">Capital: $100 | Riesgo máximo: $20</div>
  <img id="mockup" src="mockup.png" alt="Mockup CODE X"/>

<script>
async function updateSignal(){
  try {
    const market_ids = ["NBA_SIMULADO","TENNIS_SIMULADO"];
    let signals = [];
    for(let m of market_ids){
      const res = await fetch(`/signal/${m}`);
      const data = await res.json();
      signals.push(data);
    }

    const signalDiv = document.getElementById('signal');
    const sizeDiv = document.getElementById('size');
    const eventDiv = document.getElementById('event');

    let best = signals.reduce((prev, curr) => curr.momentum > prev.momentum ? curr : prev, signals[0]);

    if(best.signal === "ENTRY"){
      signalDiv.style.background = "green"; signalDiv.innerText = "ENTRY";
    } else if(best.signal === "WAIT"){
      signalDiv.style.background = "yellow"; signalDiv.innerText = "WAIT";
      signalDiv.style.color = "black";
    } else {
      signalDiv.style.background = "red"; signalDiv.innerText = "EXIT";
    }

    sizeDiv.innerText = best.size > 0 ? `Tamaño recomendado: $${best.size}` : "";
    eventDiv.innerText = `${best.market} | Momentum: ${best.momentum}`;

  } catch(e){
    console.log("Error al actualizar señal:", e);
  }
}
setInterval(updateSignal, 2000);
updateSignal();
</script>
</body>
</html>